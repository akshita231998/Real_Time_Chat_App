<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>chat</title>
    <link href="bootstrap/dist/css/bootstrap.css" rel="stylesheet">
</head>
<body style="padding: 200px">
<div id="chat">

</div>
<form id="messageForm">
    <div class="form-group">
        <label for="message">Message</label>
        <input type="text" class="form-control" id="message">
    </div>
    <button type="submit" class="btn btn-default">Submit</button>
</form>




<script src="/jquery/dist/jquery.js" > </script>
<script src="/socket.io/socket.io.js" > </script>

<script>


    $(function () {

        var socket = io.connect();
        var message = $('#message');
        var messageForm = $('#messageForm');
        var chat = $('#chat');
        var initial = 0;
//================initilize message=======
        socket.emit('initial-messages' , "initial");
//========================================
        messageForm.submit(function (data) {
           data.preventDefault();
           socket.emit('send-message' , message.val());

        });
        
        socket.on('new-message' , function (data) {
            chat.append('<ul class="list-group" > <li class="list-group-item"> '+ data.msg+'</li> </ul>');
        })
        socket.on('initial-message' , function (data) {
            if(initial == 0) {
                var arr = $.parseJSON(data.msg);
                for (var i = 0; i < arr.length; i++) {
                    chat.append('<ul class="list-group" > <li class="list-group-item"> ' + arr[i].message + '</li> </ul>');
                }
                initial++;
            }
        })




    })
</script>
</body>



</html>